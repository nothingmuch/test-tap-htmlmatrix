<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" lang = "en" xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title petal:content="page/title">TAP Matrix</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link petal:omit-tag="page/has_inline_css" rel="stylesheet" petal:attr="href page/css_uri" type="text/css" />
		<style petal:condition="true:page/has_inline_css" petal:content="structure page/inline_css" type="text/css" />
		<script petal:condition="true:page/has_javascript">
<!--

var DOM = {};


DOM.Display = function () {
    this.register = {};
}

DOM.Display.prototype = {
    register: {},

    hideElement: function (id) {
        this.registerElement(id);
        var elem = document.getElementById(id);
        if (elem == undefined) return null;
        if (elem.style.display == "none") return null;
        elem.style.display = "none";
    },

    showElement: function (id) {
        this.registerElement(id);
        var elem = document.getElementById(id);
        if (elem == undefined) return null;
        if (elem == undefined) return null;
        if (elem.style.display == "table-row-group") return null;
        elem.style.display = "table-row-group";
    },

    showOnlyElement: function (id) {
        this.registerElement(id);
        for (element in this.register)
            if (element != id)
              this.hideElement(element);
        this.showElement(id);
    },

    registerElement: function (id) {
        this.register[id] = 1;
	},

	toggleHidden: function () {
		for (var i in this.register) {
			var elem = document.getElementById(i);
			if (elem.style.display == "none") {
				elem.style.display = "table-row-group";
			} else {
				elem.style.display = "none";
			}
		}
	}
};

var toggles;

function initShow () {
	var matrix = document.getElementById('matrix');
	var bodies = matrix.childNodes;

	toggles = new Array;

	var offset = 0;
	
	for(var i = 0; i < bodies.length; i++){
		var body = bodies[i]; // thead and tfoot
		if (body.nodeType == 1 && body.id){
			var elm_cls = body.className;
			var elm_id = body.id;

			var split_id = elm_id.split('_');

			var idx = i - offset;
			
			if (split_id[0] == 'expanded') {
				var toggle = new DOM.Display();
				toggles[idx] = toggle;
				toggle.hideElement(elm_id);
				toggle.showOnlyElement('collapsed_' + split_id[1]);

				if (elm_cls == 'diff'){
					toggleDisp(idx);
				}
			} else {
				offset++;
			}
		} else {
			offset++;
		}
	}
}

function toggleDisp (elem) {
	toggles[elem].toggleHidden();
}

// -->
		</script>
	</head>
	<body onLoad="initShow()">

		<pre petal:condition="page/extra" petal:content="page/extra" />
		
		<table id="matrix" petal:attr="summary page/model/summary">
			<thead>
				<tr>
					<th class="r" petal:attr="colspan if: true:page/has_javascript then: string:3 else: string:2">Test file</th>
					<th class="r">Test cases</th>
					<th class="r">%</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<td class="r" petal:attr="colspan if: true:page/has_javascript then: string:2 else: string:1">TOTAL</td>
					<td class="r">
						<span petal:replace="page/model/test_files">f</span> files
					</td>
					<td class="r" petal:contents="page/model/summary" />
					<td class="x sum" petal:attr="style page/model/color_css" petal:content="page/model/total_percentage">100%</td>
				</tr>
			</tfoot>
			<div petal:omit-tag="string:1" petal:repeat="ctest page/tests">
				<tbody petal:condition="or: true:ctest/consistent true:page/has_javascript" petal:attr="class if: ctest/consistent then: string:collapsed normal else: string:collapsed diff; id string:collapsed_$repeat/index">
					<tr petal:define="test ctest/first_file">
						<td petal:condition="true:page/has_javascript"><a petal:condition="true:ctest/multiple_files" class="min" petal:attr="href string:javascript:toggleDisp(${repeat/index})">[+]</a></td>
						<td><a petal:attr="href test/link" petal:content="test/name">foo</a></td>
						<td class="ok" petal:content="test/str_status">OK</td>
						<td>
							<table petal:repeat="case_row test/case_rows" width="100%" summary="subtests">
								<tr>
									<td petal:repeat="case case_row/cases" petal:attr="class case/css_class">
										<a petal:attr="href case/link; title case/popup" petal:content="structure string:&amp;#160\;" />
									</td>
								</tr>
							</table>
						</td>
						<td class="x sum" petal:attr="style ctest/first_file/color_css" petal:content="ctest/percentage">100%</td> <!-- FIXME -->
					</tr>
				</tbody>
				<tbody petal:condition="and: true:ctest/multiple_files or: true:page/has_javascript false:ctest/consistent" petal:attr="class if: ctest/consistent then: string:expanded normal else: string:expanded diff; ; id string:expanded_$repeat/index">
					<tr petal:define="test ctest/first_file">
						<td petal:condition="true:page/has_javascript" petal:attr="rowspan ctest/subfile_count_plus_one"><a class="min" petal:attr="href string:javascript:toggleDisp(${repeat/index})">[-]</a></td>
						<td><a petal:attr="href test/link" petal:content="test/name">foo</a></td>
						<td />
						<td>... expanded view:</td>
						<td class="x sum" petal:attr="style ctest/first_file/color_css" petal:content="ctest/percentage">100%</td> <!-- FIXME -->
					</tr>
					<tr petal:repeat="test ctest/subfiles_ref">
						<td> <!-- FIXME - add distinguishing text --> </td>
						<td class="ok" petal:content="test/str_status">OK</td>
						<td>
							<table petal:repeat="case_row test/case_rows" width="100%" summary="subtests">
								<tr>
									<td petal:repeat="case case_row/cases" petal:attr="class case/css_class">
										<a petal:attr="href case/link; title case/popup" petal:content="structure string:&amp;#160\;" />
									</td>
								</tr>
							</table>
						</td>
						<td class="x sum" petal:attr="style test/color_css" petal:content="test/percentage">100%</td>
					</tr>
				</tbody>
			</div>
		</table>
		
	</body>
</html>
